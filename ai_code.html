<!DOCTYPE html>
<html lang="en">

<head>
    <title>Start Conv</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="refresh" content="10" />

    <!--===============================================================================================-->
    <link rel="icon" type="image/png" href="images/icons/favicon.ico" />
    <!--===============================================================================================-->
    <link rel="stylesheet" type="text/css" href="vendor/bootstrap/css/bootstrap.min.css">
    <!--===============================================================================================-->
    <link rel="stylesheet" type="text/css" href="fonts/font-awesome-4.7.0/css/font-awesome.min.css">
    <!--===============================================================================================-->
    <link rel="stylesheet" type="text/css" href="fonts/iconic/css/material-design-iconic-font.min.css">
    <!--===============================================================================================-->
    <link rel="stylesheet" type="text/css" href="vendor/animate/animate.css">
    <!--===============================================================================================-->
    <link rel="stylesheet" type="text/css" href="vendor/css-hamburgers/hamburgers.min.css">
    <!--===============================================================================================-->
    <link rel="stylesheet" type="text/css" href="vendor/animsition/css/animsition.min.css">
    <!--===============================================================================================-->
    <link rel="stylesheet" type="text/css" href="vendor/select2/select2.min.css">
    <!--===============================================================================================-->
    <link rel="stylesheet" type="text/css" href="vendor/daterangepicker/daterangepicker.css">
    <!--===============================================================================================-->
    <link rel="stylesheet" type="text/css" href="css/util.css">
    <link rel="stylesheet" type="text/css" href="css/main.css">
    <link rel="stylesheet" type="text/css" href="css/start-conv.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <!--===============================================================================================-->
</head>
<style>
    .btn-tags-blue{
        background-color: blue;
    border-radius: 10px;
    text-align: center;
    color: white;
    margin: 4px;
    margin: 3px;
    padding: 6px;
    }
    .btn-tags-gray{
        background-color: #e3e3ec;
    border-radius: 10px;
    text-align: center;
    color: black;
    width: 30%;
    margin: 4px;
    }
    .retake{
        text-align: center;
    background: #3d3db8;
    border-radius: 22px;
    width: 48%;
    margin-left: 10%;
    }
</style>
<body>
    <div id="cover-spin" >
       <p style="position: relative;
       top: 26%;
       text-align: center;
       font-size: 2em;color: #1b1c18;">Your data is under process, Please wait...</p> 
       <div class="" style="position: relative;height: 25%;text-align: center;">
          If you wish to continue you can..  
        <button class="retake" style="color: white;height: 20%;" onclick="retake();">Retake <i class="fa fa-video-camera"></i></button>
        <button class="retake" style="color: white;width: 10%;height: 20%;" onclick="nextVideo()"> <i class="fa fa-arrow-right"></i></button>
    </div>
    </div>
    
    <div class="main-container">
        
    </div>
    <div class="" style="width: 100%;background-color: #6746a6;height: 21%;color: white;text-align: center;">
        <span class="" style="font-size: 1.5em;position: relative;top: 10%;">
            < Feedback </span>
    </div>
    <div class="header" style="margin-top: -24%;overflow-y: scroll;">
        <div class="vl" style="
        border-left: 6px solid green;
        height: 100px;
        position: relative;
        left: 16%;
        top: 2%;
    "></div>
        <p style="top: -7%;
        position: relative;
        top:0;
        margin-left: 31%;margin-top: -17%;
    ">
            Good! You must first start with
            light conversation before
            jumping to business.
        </p>
        <div class="tone" style="border: 1px solid wheat;height: 9%;margin: 10%;position:relative; top:-1%;">
            <div style="float: left;width: 40%;margin-top: 10px;margin-left: 20px;">
                <b>Your Tone</b>
                <p class="tone-msg"></p>
            </div>
            <div style="float: right;margin-right: 7%;">
                <p class="emoji" style="font-size: 3em;"></p>
            </div>
        </div>
        <div style="width: 80%;margin-top: -5%;height: 20%;margin-left: 10%;">
            <div class="length" style="border: 1px solid wheat;
            width: 50%;
            height: 100%;float: left;margin-left: -2%;text-align: center;">
                <p style="font-size: 1.7em;">
                    <i class="fa fa-clock-o"></i>
                </p>
                <p style="font-size: 1.2em;">Length</p>
                <p style="color: green;font-size: 1em;">Appropriate</p>
                <!-- <p style="font-size: 2em;">0:32</p> -->
                <p style="font-size: 2em;" class="emotion-length"></p>
                <p>Target 0:30 to 1:00</p>
            </div>
            <div class="length" style="border: 1px solid wheat;
            width: 50%;
            height: 100%;float: right;margin-left: -2%;text-align: center;font-size: 18px;">
                <p style="font-size: 1.2em;">
                    <i class="fa fa-line-chart"></i>
                </p>
                <p style="font-size: 1.2em;">Pitch Rate</p>
                <p class="confidence" style="font-size: 1.7em;"></p>
                <p style="color: green;font-size: 1em;">Slow</p>
                <!-- <p style="font-size: 2em;">90 WPM</p> -->
                <p>Target 120 to 150</p>
            </div>
        </div>
        <div style="border: 1px solid wheat;margin: 9%;text-align: center;word-wrap: break-word;hyphens: auto">
            <p style="font-size: 20px;"><i class="fa fa-tag"></i></p>
            <p>Keywords Matched</p>
            <p>Good Match</p>
           <div class="buttons" style="color:blue">
                
                <!-- <button class="btn-tags-blue"></button>
                <button class="btn-tags-blue"></button>
                <button class="btn-tags-blue"></button>
                <button class="btn-tags-gray"></button>
                <button class="btn-tags-gray"></button>
                <button class="btn-tags-gray"></button>
                <button class="btn-tags-gray"></button>
                <button class="btn-tags-blue"></button> -->
            </div>
        </div>
        <div class="" style="position: relative;height: 25%;">
            
            <button class="retake" style="color: white;height: 20%;"onclick="retake();" >Retake <i class="fa fa-video-camera"></i></button>
            <button class="retake" style="color: white;width: 10%;height: 20%;" onclick="nextVideo()"> <i class="fa fa-arrow-right"></i></button>
        </div>
    </div>
    <video width="320" height="240" class="videoBg" controls id="myVideo" style="display: none;">
        <source src="videos/video2.mp4" type="video/mp4">
        <!-- <source src="movie.ogg" type="video/ogg"> -->
        Your browser does not support the video tag.
    </video>
    <!--===============================================================================================-->
    <script src="vendor/jquery/jquery-3.2.1.min.js"></script>
    <!--===============================================================================================-->
    <script src="vendor/animsition/js/animsition.min.js"></script>
    <!--===============================================================================================-->
    <script src="vendor/bootstrap/js/popper.js"></script>
    <script src="vendor/bootstrap/js/bootstrap.min.js"></script>
    <!--===============================================================================================-->
    <script src="vendor/select2/select2.min.js"></script>
    <!--===============================================================================================-->
    <script src="vendor/daterangepicker/moment.min.js"></script>
    <script src="vendor/daterangepicker/daterangepicker.js"></script>
    <!--===============================================================================================-->
    <script src="vendor/countdowntime/countdowntime.js"></script>
    <!--===============================================================================================-->
    <script src="js/main.js"></script>
    <script>
    var tag_value =  {
        "positive":"&#128522",
        "negative":"&#128532",

    }
    var accessToken = '';
    // $("#txtDisplay").html(tag_value);
   window.addEventListener('DOMContentLoaded', (event) => {
    // console.log('DOM fully loaded and parsed', localStorage.getItem('txnId'));
    $('#cover-spin').show(0)
    getAccessToken();
});
function getAccessToken(){
    var data = {
    "apiKey": "cef7afbb-68e5-43d1-9cd5-468b2f39b674",
    "apiSecret": "SVVTZEY-D3JM7M9-KKAMD2V-5WWVCX5",
    "userId": "jagadish.pujari@ilimi.in"
}
    $.ajax({
            url: 'https://api.marsview.ai/cb/v1/auth/create_access_token',
            type: 'POST',
            data: data,
            success: function (response) {
                // alert(JSON.stringify(response));
                // localStorage.setItem('accessToken', response.data.accessToken)
                accessToken = response.data.accessToken;
                getMetadata();
            },
            error: function (err) {
                alert(JSON.stringify(err));
            }
        });
}
function getMetadata(){
        $.ajax({
            url: 'https://api.marsview.ai/cb/v1/conversation/fetch_metadata/' + location.search.split('=')[1],
            type: 'GET',
            headers: {
                'Authorization': 'Bearer ' + accessToken,
            },
            crossOrigin: true,
            success: function (response) {
            //    var emojidata = Object.assign(response,tag_value)
               
                if(response.status){
                    $('#cover-spin').hide(0)
                    $(".emoji").html(tag_value[response.data.emotion[0].tone.value])
                 document.getElementsByClassName('tone-msg')[0].innerText = response.data.emotion[0].tone.value.charAt(0).toUpperCase() + response.data.emotion[0].tone.value.slice(1)
                    document.getElementsByClassName('confidence')[0].innerText = Math.round(response.data.emotion[0].tone.confidence*100) + "%";
                    //document.getElementsByClassName('buttons')[0].innerText = response.data.topicsData
                    response.data.topicsData.slice(-7).forEach(element  => {
                       // var btn = '<button class="btn-blue">' + element + '</button>';
                        var node = document.createElement('button');
                        node.className = 'btn-tags-blue'
                        node.innerText = element;
                        document.getElementsByClassName('buttons')[0].appendChild(node);
                    });
                    document.getElementsByClassName('emotion-length')[0].innerText = response.data.emotion.length

                }
                // console.log(emojidata);
            },
            error: function (err) {
                alert(JSON.stringify(err));
            }
        });
    }
        function retake(){
            $('#cover-spin').hide(0)
            location.href = 'record.html';
        }
        const video = document.getElementById("myVideo");
        const source = document.createElement("source");

        function loadVideo(element, src) {
            source.src = src;
            // element.appendChild(source);
            // element.load();
            // element.play();
            $('#myVideo').css('display', 'block');
            // document.getElementsByTagName('video')[0].webkitEnterFullscreen(); 
        }
        function nextVideo(){
            $('#cover-spin').hide(0)
            loadVideo(
                video,
                "https://www.youtube.com/watch?v=iDVItAX-meU"
            )
        }
        document.getElementById('myVideo').addEventListener('ended', myHandler, false);
    function myHandler(e) {
        // What you want to do after the event
        console.log("Hey I am finished");
        location.href = "record.html";
    }
    </script>
</body>

</html>